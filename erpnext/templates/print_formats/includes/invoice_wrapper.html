{%- set show_amounts = doc.doctype not in ["Delivery Note", "Purchase Receipt"] -%}
{%- set show_discount = doc.doctype not in ["Supplier Quotation", "Purchase Order", "Purchase Receipt", "Purchase Invoice"] -%}

{%- set company = frappe.get_cached_doc("Company", doc.company) -%}
{%- set address = doc.company_address_doc -%}

{% macro row(label, value, value_border=True, hide_empty=True, empty_value=None, style=None, condition=True) -%}
	{% if condition and not hide_empty or (value and value != empty_value) %}
	<div class="print-row"{% if style %} style="{{ style }}"{% endif %}>
		<div class="print-col">{{ _(label) }}:</div>
		<div class="value {% if value_border %}value-border{% endif %}">{{ value }}</div>
	</div>
	{% endif %}
{%- endmacro %}

{% macro table_col(label, value, hide_empty=True, empty_value=None, style=None, condition=True, suffix=None) -%}
	{% if condition and not hide_empty or (value and value != empty_value) %}
	<td>{% if label %}<strong>{{ _(label) }}:</strong> {% endif %}{{ value }}{% if suffix %}{{ suffix }}{% endif %}</td>
	{% endif %}
{%- endmacro %}

<div class="transaction-pf page-break">

	<!-- Header Section -->
	<div id="header-html" class="hidden-pdf">
		<div class="transaction-pf">
			<div class="letter-head">
			{% if not no_letterhead %}
				<div class="clearfix" style="width:100%;border-bottom:#000 1px solid;">
					{% if company.invoice_letterhead  %}
						{{ company.invoice_letterhead }}
					{% else %}
						<div class="visible-pdf" style="line-height:0.8">&nbsp;</div>
						<div class="pull-left"><h1 style="margin:0;font-size:24pt;">
							{{ doc.company }}
						</h1></div>
						<div class="pull-right"></div>
					{% endif %}
				</div>
			{% endif %}

				<div class="clearfix">
					<div class="pull-right text-right" style="width:30%">
						<h2 style="margin:0;font-size:18pt;">{{ doc.select_print_heading or doc.doctype }}{% if doc.docstatus == 0 %} (Draft){% endif %}</h2>
						<h6 style="margin:0;font-size:10pt;">{% if doc.get("stin") %}<strong>Invoice #:</strong> {% endif %}{{ frappe.original_name(doc) }}</h6>
						<p class="small page-number visible-pdf">
							{{ _("Page {0} of {1}").format('<span class="page"></span>', '<span class="topage"></span>') }}
						</p>
					</div>
					{% if not no_letterhead %}
					<div class="pull-left" style="width:70%;margin-bottom:2mm;">
						{% if address %}<div>{{ address.address_line1 }}, {{ address.city }}, {{ address.country }}</div>{% endif %}
						<div>
							{% if company.phone_no %}Tel: {{ company.phone_no }}{% endif %}{% if company.fax %}, Fax: {{ company.fax }}{% endif %}{% if company.email %}, Email: {{ company.email }}{% endif %}
						</div>
						{% if company.tax_strn %}<div>Sales Tax Reg No: {{ company.tax_strn }}</div>{% endif %}
						{% if company.tax_id %}<div>NTN: {{ company.tax_id }}</div>{% endif %}
						{% if company.provincial_strn and company.provincial_strn %}<div>Sindh STRN: {{ company.provincial_strn }}</div>{% endif %}
					</div>
					{% endif %}
				</div>
			</div>

			<div class="sec-details clearfix">
				<div class="party">
					<strong>{{ row('Billed To', doc.bill_to_name or doc.customer_name) }}</strong>
					{{ row('Customer', doc.customer_name, condition=doc.bill_to and doc.customer != doc.bill_to) }}
					{{ row('Address', doc.address_display, style="line-height:1.3;") }}
					{{ row('Port Of Loading', doc.pol_address_display, style="line-height:1.3;") }}
					{{ row('Port Of Arrival', doc.poa_address_display, style="line-height:1.3;") }}
					{{ row('Description', doc.remarks, empty_value="No Remarks") }}
					{% if doc.delivery_notes -%}
						{{ row('Delivery', frappe.list_original_names("Delivery Note", doc.delivery_notes)|join(', ')) }}
					{%- endif %}
					{% if doc.sales_team -%}
						{{ row('Advisor', doc.sales_team|map(attribute='sales_person')|join(', ')) }}
					{%- endif %}
				</div>
				<div class="doc">
					{{ row('Date', frappe.format_date(doc.posting_date, "d MMMM, Y")) }}
					{{ row('Payment', "Credit" if not doc.is_pos else doc.payments|map(attribute="mode_of_payment")|unique|join('/') or 'Cash') }}
					{{ row('STRN', doc.tax_strn) }}
					{{ row('NTN/CNIC', doc.tax_id or doc.tax_cnic) }}
					{{ row('PO #', doc.po_no) }}
					{{ row('RO #', doc.project) }}
					{{ row('Against', doc.get('return_against')) }}
					<div class="print-row clearfix">
						<strong class="pull-left text-right" style="width: 31%">Original: </strong><div class="print-checkbox pull-left" style="margin-left: 5px"></div>
						<strong class="pull-left" style="margin-left: 17px">Duplicate: </strong><div class="print-checkbox pull-left" style="margin-left: 5px"></div>
					</div>
				</div>
			</div>

			{% if doc.get('applies_to_item') or doc.get('vehicle_license_plate') or doc.get('vehicle_engine_no') or doc.get('vehicle_chassis_no') or doc.get('vehicle_last_odometer') %}
			<table class="table table-bordered no-bt">
				<tr class="no-bt">
					{{ table_col(None, doc.get('applies_to_item_name')) }}
					{{ table_col('Reg #', doc.get('vehicle_license_plate')) }}
					{{ table_col('Engine #', doc.get('vehicle_engine_no')) }}
					{{ table_col('Chassis #', doc.get('vehicle_chassis_no')) }}
					{{ table_col('Odometer', doc.get('vehicle_last_odometer'), suffix=" km") }}
				</tr>
			</table>
			{% endif %}

			{% if doc.get('insurance_company') or doc.get('insurance_surveyor') %}
			<table class="table table-bordered no-bt">
				<tr class="no-bt">
					{{ table_col('Insurance', doc.get('insurance_company_name')) }}
					{{ table_col('Loss #', doc.get('insurance_loss_no')) }}
					{{ table_col('Policy #', doc.get('insurance_policy_no')) }}
					{{ table_col('Surveyor', doc.get('insurance_surveyor')) }}
				</tr>
			</table>
			{% endif %}
		</div>
	</div>

{% include template_file or 'templates/print_formats/includes/tax_exclusive_transaction.html' %}

	<!-- Footer Section -->
	<div id="footer-html" class="visible-pdf" style="display: block !important; order: 1;">
		<div class="letter-head-footer">
			<div class="sec-terms">
				<div><strong>{{ _("Amount") }}:</strong> {{ doc.in_words }}</div>
				<div><strong>{{ _("Payment Instructions") }}:</strong> {{ _("Please mention the invoice number at the back of the cheque.") }}</div>
			</div>

			<div class="sec-signature" style="text-align:center;margin-top:15mm;">
				<div class="clearfix">
					<div class="pull-left" style="width:25%;margin-top:-3.75mm;font-size:11pt;">{{ frappe.get_fullname(doc.owner) }}</div>
				</div>
				<div class="clearfix">
					<div class="pull-left" style="width:25%; border-top:#000 1px solid">{{ _("Prepared By") }}</div>
					<div class="pull-right" style="width:25%; border-top:#000 1px solid">{{ _("Received By") }}</div>
					<div style="width:25%; margin:0 auto; border-top:#000 1px solid">{{ _("Checked By") }}</div>
				</div>
			</div>
		</div>
	</div>

</div>