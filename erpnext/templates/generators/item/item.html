{% extends "templates/web.html" %}

{% block title %} {{ title }} {% endblock %}

{% block breadcrumbs %}
	{% include "templates/includes/breadcrumbs.html" %}
{% endblock %}

{% block page_content %}
{% from "erpnext/templates/includes/macros.html" import product_image %}
<div class="item-content">
	<div class="product-page-content" itemscope itemtype="http://schema.org/Product">
		<div class="row">
			{% include "templates/generators/item/item_image.html" %}
			{% include "templates/generators/item/item_details.html" %}
		</div>

		<div class="row">
			{% include "templates/generators/item/item_specifications.html" %}
		</div>

		{% if doc.website_content %}
		{{ doc.website_content }}
		{% endif %}

		{% if frappe.db.get_value('Products Settings', 'Products Settings', 'show_item_attribute_table') | int %}
		<div class="row">
			{% include "templates/generators/item/item_variant_table.html" %}
		</div>
		{% endif %}
	</div>
</div>
<script>

	{% if variant_info %}
	window.variant_info = {{ variant_info }};
	{% else %}
	window.variant_info = null;
	{% endif %}

	{% include "templates/includes/product_page.js" %}

	/*
	frappe.ready(() => {
		$('.page_content').on('click', '.item-variant-add-to-cart', (e) => {
			const item_code = $(e.currentTarget).data().itemCode;
			erpnext.shopping_cart.update_cart({
				item_code,
				qty: 1
			});
		});

		$('[data-variant-item-code]').each(function() {
			const $this = $(this);
			const item_code = $this.data().variantItemCode;
			get_item_info(item_code)
				.then(r => {
					if (!r.message) return;
					if(r.message.cart_settings.enabled) {
						// $this.find(".item-cart, .item-price, .item-stock").toggleClass("hidden", (!!!r.message.product_info.price || !!!r.message.product_info.in_stock));
					}
					if(r.message.cart_settings.show_price) {
						$this.find(".item-price").toggleClass("hidden", false);
					}
					if(r.message.cart_settings.show_stock_availability) {
						$this.find(".item-stock").toggleClass("hidden", false);
					}
					if(r.message.product_info.price) {
						$this.find(".item-price")
							.html(r.message.product_info.price.formatted_price_sales_uom + "<div style='font-size: small'>\
								(" + r.message.product_info.price.formatted_price + " / " + r.message.product_info.uom + ")</div>");

						if(r.message.product_info.in_stock==0) {
							$this.find(".item-stock").html(`<div style='color: red'> <i class='fa fa-close'></i> ${__('Not in stock')}</div>`);
						}
						else if(r.message.product_info.in_stock==1) {
							var qty_display = __('In stock');
							if (r.message.product_info.show_stock_qty) {
								qty_display += " ("+r.message.product_info.stock_qty+")";
							}
							$this.find(".item-stock").html("<div style='color: green'>\
								<i class='fa fa-check'></i> "+qty_display+"</div>");
						}
					}
				})
		})

		function get_item_info(item_code) {
			return frappe.call({
				type: "POST",
				method: "erpnext.shopping_cart.product_info.get_product_info_for_website",
				args: { item_code }
			})
		}
	})
	*/
</script>
{% endblock %}

{% block base_scripts %}
<!-- js should be loaded in body! -->
<script type="text/javascript" src="/assets/frappe/js/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/frappe-web.min.js"></script>
<script type="text/javascript" src="/assets/js/control.min.js"></script>
<script type="text/javascript" src="/assets/js/dialog.min.js"></script>
<script type="text/javascript" src="/assets/js/bootstrap-4-web.min.js"></script>
{% endblock %}