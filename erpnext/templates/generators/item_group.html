{% from "erpnext/templates/includes/macros.html" import field_filter_section, attribute_filter_section, discount_range_filters %}
{% extends "templates/web.html" %}

{% block header %}
<!-- <h2>{{ title }}</h2> -->
{% endblock header %}

{% block script %}
<script type="text/javascript" src="/all-products/index.js"></script>
{% endblock %}

{% block breadcrumbs %}
<div class="item-breadcrumbs small text-muted">
	{% include "templates/includes/breadcrumbs.html" %}
</div>
{% endblock %}

{% block page_content %}
<div class="item-group-content" itemscope itemtype="http://schema.org/Product">
	<div class="item-group-slideshow">
		{% if slideshow %}<!-- slideshow -->
			{{ web_block(
				"Hero Slider",
				values=slideshow,
				add_container=0,
				add_top_padding=0,
				add_bottom_padding=0,
			) }}
		{% endif %}
		<h2 class="mt-3">{{ title }}</h2>
		{% if description %}<!-- description -->
		<div class="item-group-description text-muted mb-5" itemprop="description">{{ description or ""}}</div>
		{% endif %}
	</div>
	<div class="row">
		<div class="col-12 order-2 col-md-9 order-md-2 item-card-group-section">
			{% if sub_categories %}
			<div class="sub-category-container">
				<div class="heading"> {{ _('Sub Categories') }} </div>
			</div>
			<div class="sub-category-container scroll-categories">
				{% for row in sub_categories%}
				<a href="{{ row.route or '#' }}" style="text-decoration: none;">
					<div class="category-pill">
						{{ row.name }}
					</div>
				</a>
				{% endfor %}
			</div>
			{% endif %}
			<div class="row products-list">
				{% if items %}
					{% for item in items %}
						{% include "erpnext/www/all-products/item_row.html" %}
					{% endfor %}
				{% else %}
					{% include "erpnext/www/all-products/not_found.html" %}
				{% endif %}
			</div>
		</div>
		<div class="col-12 order-1 col-md-3 order-md-1">
			<div class="collapse d-md-block mr-4 filters-section" id="product-filters">
				<div class="d-flex justify-content-between align-items-center mb-5 title-section">
					<div class="mb-4 filters-title" > {{ _('Filters') }} </div>
					<a class="mb-4 clear-filters" href="/{{ doc.route }}">{{ _('Clear All') }}</a>
				</div>
				<!-- field filters -->
				{{ field_filter_section(field_filters) }}

				<!-- attribute filters -->
				{{ attribute_filter_section(attribute_filters) }}

				<!-- discount filters -->
				{% if discount_filters %}
					{{ discount_range_filters(discount_filters) }}
				{% endif %}
			</div>

			<script>
				frappe.ready(() => {
					$('.product-filter-filter').on('keydown', frappe.utils.debounce((e) => {
						const $input = $(e.target);
						const keyword = ($input.val() || '').toLowerCase();
						const $filter_options = $input.next('.filter-options');

						$filter_options.find('.custom-control').show();
						$filter_options.find('.custom-control').each((i, el) => {
							const $el = $(el);
							const value = $el.data('value').toLowerCase();
							if (!value.includes(keyword)) {
								$el.hide();
							}
						});
					}, 300));
				})
			</script>
		</div>
	</div>
	<div class="row">
		<div class="col-12">
			{% if frappe.form_dict.start|int > 0 %}
			<button class="btn btn-outline-secondary btn-prev" data-start="{{ frappe.form_dict.start|int - page_length }}">{{ _("Prev") }}</button>
			{% endif %}
			{% if items|length >= page_length %}
			<button class="btn btn-outline-secondary btn-next" data-start="{{ frappe.form_dict.start|int + page_length }}">{{ _("Next") }}</button>
			{% endif %}
		</div>
	</div>
</div>
{% endblock %}